<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Phrasor V1</title>
  <style>
    /* Layout */
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      background: #111;
      color: #d0f6f0;
      font-family: monospace;
    }

    .logic {
      background: #000;
      padding: 16px;
      min-height: 35vh;
      box-sizing: border-box;
      color: #6af5db;
      font-size: 14px;
      border: none;
      outline: none;
      resize: none;
      width: 100%;
      font-family: inherit;
    }

    .natural {
      flex: 1;
      background: #fff;
      color: #111;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-family: "Georgia", "Times New Roman", serif;
      font-size: clamp(24px, 5vw, 48px);
      padding: 32px;
      box-sizing: border-box;
      user-select: none;
      overflow-wrap: anywhere;
    }

    .phrase {
      line-height: 1.4;
      transition: color 0.2s ease;
    }

    .word {
      cursor: ns-resize;
      transition: color 0.2s ease, background 0.2s ease;
      padding: 2px 4px;
      border-radius: 4px;
      white-space: pre;
      display: inline-block;
    }

    .word:active {
      background: #eef;
    }
  </style>
</head>
<body>
  <textarea class="logic" aria-label="Espace logique">D N V Adv, C D N Adj V !</textarea>
  <div class="natural" aria-live="polite">
    <div class="phrase"></div>
  </div>

  <script>
    // Dictionnaires immuables pour chaque symbole reconnu
    const banks = {
      D: ["le", "la", "les", "un", "une", "ce", "cette", "cet", "mon", "ton", "son"],
      N: ["feu", "monde", "machine", "corps", "temps", "regard", "silence", "nuit", "lumière", "matière", "système", "souffle"],
      V: ["brûle", "traverse", "éclaire", "calcule", "observe", "persiste", "glisse", "tombe", "résonne", "attend", "transforme"],
      Adj: ["fragile", "lent", "sacré", "instable", "froid", "lumineux", "secret", "dense", "immobile", "profond"],
      Adv: ["lentement", "brutalement", "silencieusement", "soudainement", "éternellement", "presque", "parfois"],
      Prep: ["dans", "sur", "sous", "avec", "contre", "entre", "parmi"],
      C: ["et", "mais", "donc", "car", "pourtant", "ou", "tandis que", "alors"]
    };

    const logicInput = document.querySelector('.logic');
    const phraseContainer = document.querySelector('.phrase');

    // Parse la formule en tokens symboliques ou littéraux
    function parseFormula(formula) {
      const rawTokens = formula.trim().length ? formula.trim().split(/\s+/) : [];
      return rawTokens.map(token => {
        if (Object.prototype.hasOwnProperty.call(banks, token)) {
          return { type: 'symbol', value: token };
        }
        return { type: 'literal', value: token };
      });
    }

    // Crée un span interactif pour un symbole grammatical
    function createWordSpan(symbol) {
      const span = document.createElement('span');
      span.className = 'word';
      span.dataset.symbol = symbol;
      span.dataset.index = '0';
      span.textContent = banks[symbol][0];

      span.addEventListener('wheel', (event) => {
        event.preventDefault();
        const bank = banks[symbol];
        let idx = parseInt(span.dataset.index, 10);
        idx = event.deltaY < 0 ? idx + 1 : idx - 1;
        if (idx < 0) idx = bank.length - 1;
        if (idx >= bank.length) idx = 0;
        span.dataset.index = String(idx);
        span.textContent = bank[idx];
      });

      return span;
    }

    // Reconstruit la phrase naturelle depuis la formule
    function renderPhrase() {
      phraseContainer.innerHTML = '';
      const tokens = parseFormula(logicInput.value);

      tokens.forEach((token, idx) => {
        if (idx > 0) {
          phraseContainer.appendChild(document.createTextNode(' '));
        }

        if (token.type === 'symbol') {
          phraseContainer.appendChild(createWordSpan(token.value));
        } else {
          const text = document.createElement('span');
          text.textContent = token.value;
          phraseContainer.appendChild(text);
        }
      });
    }

    // Met à jour en temps réel lors de la saisie
    logicInput.addEventListener('input', renderPhrase);

    // Initialisation
    renderPhrase();
  </script>
</body>
</html>
